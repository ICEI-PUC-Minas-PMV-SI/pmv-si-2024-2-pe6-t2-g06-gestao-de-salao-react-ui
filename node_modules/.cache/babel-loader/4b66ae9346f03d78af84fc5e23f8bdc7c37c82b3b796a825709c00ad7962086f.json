{"ast":null,"code":"var _jsxFileName = \"C:\\\\ProjetoSalao\\\\pmv-si-2024-2-pe6-t2-g06-gestao-de-salao-react-ui\\\\src\\\\Pages\\\\Context\\\\UserProvider.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useEffect, useState } from \"react\";\n// Ensure this type includes only the necessary properties\nimport { useNavigate } from \"react-router-dom\";\nimport { loginAPI } from \"../Services/AuthService\";\nimport { toast } from \"react-toastify\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UserContext = /*#__PURE__*/createContext({});\nexport const UserProvider = ({\n  children\n}) => {\n  _s();\n  const navigate = useNavigate();\n  const [token, setToken] = useState(null);\n  const [userId, setUserId] = useState(null);\n  const [user, setUser] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n\n  // Load stored token and user data from local storage on initial mount\n  useEffect(() => {\n    const storedUser = localStorage.getItem(\"user\");\n    const storedToken = localStorage.getItem(\"token\");\n    if (storedUser && storedToken) {\n      setUser(JSON.parse(storedUser));\n      setToken(storedToken);\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${storedToken}`;\n    }\n    setIsReady(true); // Indicate that the user context is ready\n  }, []);\n\n  // Login function\n  const loginUser = async (email, senha) => {\n    try {\n      const res = await loginAPI(email, senha);\n      if (res) {\n        const {\n          jwtToken,\n          userId\n        } = res; // Correctly extract jwtToken and userId\n\n        // Save token and user data to local storage\n        localStorage.setItem(\"token\", jwtToken);\n        localStorage.setItem(\"userId\", userId);\n        const userObj = {\n          email,\n          senha,\n          userId\n        }; // Create a user profile object without password for security\n\n        // Set state and axios authorization header\n        setToken(jwtToken);\n        setUser(userObj);\n        axios.defaults.headers.common[\"Authorization\"] = `Bearer ${jwtToken}`;\n\n        // toast.success(\"Login Successful!\");\n\n        // Return the userId for redirection\n        return userId;\n      } else {\n        throw new Error(\"Invalid login response\");\n      }\n    } catch (error) {\n      const errorMessage = getErrorMessage(error);\n      toast.error(errorMessage);\n      throw new Error(errorMessage); // Throw error to propagate back to the LoginPage for handling\n    }\n  };\n\n  // Function to get error message\n  const getErrorMessage = error => {\n    if (error.response) {\n      console.error(\"Login error:\", error.response.data);\n      return \"Login failed: \" + error.response.data.message;\n    } else if (error.request) {\n      console.error(\"No response received:\", error.request);\n      return \"No response from server. Please try again later.\";\n    } else {\n      console.error(\"Error:\", error.message);\n      return \"An error occurred during login.\";\n    }\n  };\n\n  // Check if user is logged in\n  const isLoggedIn = () => !!token; // Check if token exists to determine login status\n\n  // Logout function\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"user\");\n    setUser(null);\n    setToken(null);\n    delete axios.defaults.headers.common[\"Authorization\"]; // Clear the authorization header\n    navigate(\"/\"); // Redirect to homepage after logout\n  };\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: {\n      loginUser,\n      user,\n      token,\n      logout,\n      isLoggedIn\n    },\n    children: isReady ? children : null\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 9\n  }, this);\n};\n\n// Hook to use the authentication context\n_s(UserProvider, \"dWtLRRnWIKPyFdWMV2l2zdKmemE=\", false, function () {\n  return [useNavigate];\n});\n_c = UserProvider;\nexport const useAuth = () => {\n  _s2();\n  return React.useContext(UserContext);\n};\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","useNavigate","loginAPI","toast","axios","jsxDEV","_jsxDEV","UserContext","UserProvider","children","_s","navigate","token","setToken","userId","setUserId","user","setUser","isReady","setIsReady","storedUser","localStorage","getItem","storedToken","JSON","parse","defaults","headers","common","loginUser","email","senha","res","jwtToken","setItem","userObj","Error","error","errorMessage","getErrorMessage","response","console","data","message","request","isLoggedIn","logout","removeItem","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","useContext","$RefreshReg$"],"sources":["C:/ProjetoSalao/pmv-si-2024-2-pe6-t2-g06-gestao-de-salao-react-ui/src/Pages/Context/UserProvider.tsx"],"sourcesContent":["import React, { createContext, useEffect, useState } from \"react\";\r\nimport { UserProfile } from \"../Models/User\"; // Ensure this type includes only the necessary properties\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { loginAPI } from \"../Services/AuthService\";\r\nimport { toast } from \"react-toastify\";\r\nimport axios from \"axios\";\r\n\r\ntype UserContextType = {\r\n    user: UserProfile | null;\r\n    token: string | null;\r\n    loginUser: (email: string, senha: string) => Promise<string>; // Return userId as a string\r\n    logout: () => void;\r\n    isLoggedIn: () => boolean;\r\n};\r\n\r\ntype Props = { children: React.ReactNode };\r\n\r\nconst UserContext = createContext<UserContextType>({} as UserContextType);\r\n\r\nexport const UserProvider = ({ children }: Props) => {\r\n    const navigate = useNavigate();\r\n    const [token, setToken] = useState<string | null>(null);\r\n    const [userId, setUserId] = useState<number | null>(null);\r\n    const [user, setUser] = useState<UserProfile | null>(null);\r\n    const [isReady, setIsReady] = useState(false);\r\n\r\n    // Load stored token and user data from local storage on initial mount\r\n    useEffect(() => {\r\n        const storedUser = localStorage.getItem(\"user\");\r\n        const storedToken = localStorage.getItem(\"token\");\r\n\r\n        if (storedUser && storedToken) {\r\n            setUser(JSON.parse(storedUser));\r\n            setToken(storedToken);\r\n            axios.defaults.headers.common[\"Authorization\"] = `Bearer ${storedToken}`;\r\n        }\r\n        setIsReady(true); // Indicate that the user context is ready\r\n    }, []);\r\n\r\n    // Login function\r\n    const loginUser = async (email: string, senha: string): Promise<string> => {\r\n        try {\r\n            const res = await loginAPI(email, senha);\r\n            if (res) {\r\n                const { jwtToken, userId } = res; // Correctly extract jwtToken and userId\r\n\r\n                // Save token and user data to local storage\r\n                localStorage.setItem(\"token\", jwtToken);\r\n                localStorage.setItem(\"userId\", userId);\r\n\r\n                const userObj: UserProfile = { email, senha, userId }; // Create a user profile object without password for security\r\n\r\n                // Set state and axios authorization header\r\n                setToken(jwtToken);\r\n                setUser(userObj);\r\n                axios.defaults.headers.common[\"Authorization\"] = `Bearer ${jwtToken}`;\r\n\r\n                // toast.success(\"Login Successful!\");\r\n\r\n                // Return the userId for redirection\r\n                return userId;\r\n            } else {\r\n                throw new Error(\"Invalid login response\");\r\n            }\r\n        } catch (error: any) {\r\n            const errorMessage = getErrorMessage(error);\r\n            toast.error(errorMessage);\r\n            throw new Error(errorMessage); // Throw error to propagate back to the LoginPage for handling\r\n        }\r\n    };\r\n\r\n    // Function to get error message\r\n    const getErrorMessage = (error: any): string => {\r\n        if (error.response) {\r\n            console.error(\"Login error:\", error.response.data);\r\n            return \"Login failed: \" + error.response.data.message;\r\n        } else if (error.request) {\r\n            console.error(\"No response received:\", error.request);\r\n            return \"No response from server. Please try again later.\";\r\n        } else {\r\n            console.error(\"Error:\", error.message);\r\n            return \"An error occurred during login.\";\r\n        }\r\n    };\r\n\r\n    // Check if user is logged in\r\n    const isLoggedIn = () => !!token; // Check if token exists to determine login status\r\n\r\n    // Logout function\r\n    const logout = () => {\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"user\");\r\n        setUser(null);\r\n        setToken(null);\r\n        delete axios.defaults.headers.common[\"Authorization\"]; // Clear the authorization header\r\n        navigate(\"/\"); // Redirect to homepage after logout\r\n    };\r\n\r\n    return (\r\n        <UserContext.Provider value={{ loginUser, user, token, logout, isLoggedIn }}>\r\n            {isReady ? children : null}\r\n        </UserContext.Provider>\r\n    );\r\n};\r\n\r\n// Hook to use the authentication context\r\nexport const useAuth = () => React.useContext(UserContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}